
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Markdown/">
      
      
        <link rel="next" href="../ChatApp/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Encoding and Embedding - LM Markdown for Education</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Merriweather";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="slate" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#encoding-and-embeddings" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LM Markdown for Education" class="md-header__button md-logo" aria-label="LM Markdown for Education" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LM Markdown for Education
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Encoding and Embedding
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="slate" data-md-color-accent="custom"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LM Markdown for Education" class="md-nav__button md-logo" aria-label="LM Markdown for Education" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    LM Markdown for Education
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Handbook
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Handbook
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation and quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RAGauthoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RAG authoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Markdown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Working with Markdown
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Encoding and Embedding
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Encoding and Embedding
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparing-text-for-ingestion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Preparing text for ingestion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#language-model-directives-or-code-that-create-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Language model directives or code that create annotations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual annotations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reviewing-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reviewing annotations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoding-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Encoding model
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ChatApp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Main Chatbot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Architecture/Overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Architecture/Architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Outline Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Architecture/Implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Outline Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/Configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration modules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/Configuration/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module config.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/Configuration/appchat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module appchat.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Apps
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Apps
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/Apps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Apps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/Apps/appChat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    App Chat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/Apps/appWebcast/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    App Webcast
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Utilities
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/appbase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    App Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/apputils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    App Utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/background_task_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Background Task Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/logging_db/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logging DB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    CLI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/cli_lmme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LMME
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/cli_terminal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terminal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    RAG
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    RAG
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/scan_rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module scan_rag.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/ingest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module ingest.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/querydb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module querydb.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/query/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module query.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    LMM Workflows
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    LMM Workflows
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_1" >
        
          
          <label class="md-nav__link" for="__nav_4_6_1" id="__nav_4_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Workflows and graphs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Workflows and graphs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/workflow_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/chat_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/chat_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/workflow_factory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow factory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_2" >
        
          
          <label class="md-nav__link" for="__nav_4_6_2" id="__nav_4_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Streams
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Streams
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/stream_adapters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stream adapters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/chat_stream_adapters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chat stream adapters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Vector Stores
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Vector Stores
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/vector_store_qdrant/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module vector_store_qdrant.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/vector_store_qdrant_langchain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module vector_store_qdrant_langchain.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/vector_store_qdrant_context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module vector store context
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API/vector_store_qdrant_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparing-text-for-ingestion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Preparing text for ingestion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#language-model-directives-or-code-that-create-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Language model directives or code that create annotations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual annotations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reviewing-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reviewing annotations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encoding-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Encoding model
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="encoding-and-embeddings">Encoding and embeddings</h1>
<p>The basis of retrieval-augmented generation (RAG) is the selection of textual material from a database. This material is given to the large language model to provide an answer to the user's query. The retrieval of correct material is therefore crucial for the performance of the RAG system. The material of a RAG system is stored in a database which is accessed during the generation of responses.</p>
<p>Vector database are special because they allow retrieving data based on a search query that contains natural text, such as a question (<em>semantic search</em>). This differs from standard relational databases, where the search is based on matching the content of a field or searching part of text for keywords. The advantage of semantic search, relative to keyword search (such as the one used to search the web) is the capacity to disambiguate a word using its context. For example, the word 'black' has very different meanings in "dressed in black" and "black friday". Large language model provide representations of the meaning of whole sentences (<em>embeddings</em>), which contain the context required for this disambiguation. But another big advantage of semantic search is that the query is given by the question directly: there is no need to transform it into a set of keywords or into the specialized format of relational database queries. An embedding is created for the question itself using the same procedure for creating embeddings of text. The text in the database is then retrieved with the embeddings that are most similar to the embedding of the question.</p>
<p>Initial typical implementations of RAG made extensive use of semantic search and vector databases. The text is chunked into pieces, and these pieces are inserted into the database together with their embeddings. There are two issues with using semantic search directly to feed the language model, however. First, while the chunks may be retrieved correctly, they may lack the overall context. Chunk-based retrieval has a tendency to provide disorganized fragments of text. The second is simply failure to retrieve relevant fragments.</p>
<p>There are two ways to address these shortcomings.</p>
<ol>
<li>Instead of retrieving the chunks, the system may retrieve the surrounding text as well, or the paragraphs, or the chapters of text, where the chunks are located. LM Markdown for Education adopts the approach of optionally retrieving whole chapters, which in markdown are defined by headings, instead of chunks.</li>
<li>Instead of creating embeddings of the chunk content, the text is preliminary processed to extract information that is relevant for retrieval: what we call here an <em>encoding</em>. This information may then be used for embeddings or in a traditional keyword-based search. We refer here to the specification of a strategy to extract or define this information as to the <em>encoding model</em>. More generally, the encoding model may refer to the content of the chunks or of any property extracted from text, or any mixture of those. The original text is the <em>content</em> of the chunk, while other properties are referred to as <em>metadata</em> or <em>annotations</em>.</li>
</ol>
<p>There are two types of embeddings: dense and sparse. Dense embeddings are provided by language models or other models trained from large corpora of text in the same way. Sparse embeddings are more similar to keywords, but are capable to match semantically related words even if the words are not identical. Depending on the kind of encoding, either or both may be used to represent content in the database. Here, we refer to the combination chosen to represent an encoding as the <em>embedding model</em>: dense, sparse, or a combination of both.</p>
<p>While the encoding model specifies how and what parts of the text are used to represent meaning, the embedding model specifies if the representation consists of dense or of sparse embeddings. In general, dense embeddings are used for the chunks of text that represent the text stored in the RAG database or from complex textual annotations (for example, summaries). In constrast, sparse embeddings, and possibly dense embeddings, are usually formed from keyword-like annotations. Both types of annotations enrich the text so as to increase the efficiency of its retrieval. One common strategy is to couple text with the questions that the text answers, or other metadata such as keywords, the title of the heading, etc. These data can then be combined with the text of the dense embeddings, or be kept separate for an additional embedding, usually of the sparse variety.</p>
<p>Most often, annotations are produced by a language model prior to ingestion, but the framework allows one to add or review them manually.</p>
<h2 id="preparing-text-for-ingestion">Preparing text for ingestion</h2>
<p>The encoding model determines how the text is prepared for ingestion:</p>
<p>annotation model          --&gt;   encoding model  --&gt;   embedding model
(and its implementation)</p>
<p>Note that the implementation of the annotation model is not a monolithic step, as it depends on whether the annotations should be created by code, a language model, or manually. When the annotations are created by code or a language model, they are automatically added to the annotation model. However, it is also possible to annotate parts of text manually and add the relevant information to the annotation model. In short, annotations may be those that are added automatically when code or language models are directed to process text, or those that are added by explictly listing them in the annotation model.</p>
<p>Annotations are written in the markdown text in metadata blocks, i.e. special markdown blocks that refer to the text block that follows. When they precede a heading, they refer to all text blocks under that heading, unless overridden by metadata preceding sub-headings. Therefore, the process to which annotiation contribute to the semantic encoding of text is transparent. Properties in metadata are not automatically considered annotations; they must be added to the annotation model.</p>
<h2 id="language-model-directives-or-code-that-create-annotations">Language model directives or code that create annotations</h2>
<p>Markdown files may be reviewed by a large language model, and part of this review is the creation of annotations. When annotations are produced in this way, they are automatically added to the annotation model.</p>
<p>The following directives create annotations: <code>questions = True</code>, <code>titles = True</code>. The directive <code>summaries = True</code> creates additional text, not annotations. These directives are added to the [RAG] section of config.toml:</p>
<pre><code>[RAG]
questions = True
titles = True
</code></pre>
<p>This has the following effect on the markdown:</p>
<pre><code class="language-markdown">---
~txthash: S/ec1NIX0xV3NhFFuHY6bQ
titles: Chapter 1 - What are linear models?
questions: What are the two main ways linear models are used in practice? - How do linear models relate predictors to an outcome variable? - Why is understanding the output of linear models important for their correct application?  - How do generalizations of linear models enable capturing more complex associations? - In what way does the purpose of a linear model (prediction vs. inference) affect the consideration of confounding factors?
---
## What are linear models?

Linear models and their generalizations constitute the majority of the statistical models used in practice. Here, we will look at linear models from a practical perspective, emphasizing the issues in correctly applying them and in understanding their output.

(further text omitted) ....

</code></pre>
<p>As the example shows, setting the <code>questions</code> and the <code>titles</code> in the configuration file has the effect of creating headiers before all headings in a markdown files with two metadata properties containing the annotations (the example only shows one of such headings). The metadata block may contain any other property, but some property keys (such as <code>questions</code>, <code>titles</code> and <code>summary</code>) are reserved for LM Markdown for Education. Note also the <code>~txthash</code> property. This is an automatically generated hash that checks that the text has not changed since the last time annotations were computed. Annotations are not recomputed if the text to which they refer was not changed.</p>
<p>When an encoding model is specified in the <code>[RAG]</code> section of the configuration file, the annotations are automatically generated with a language model prior to ingesting the text in the vector database. If a metadata property containing an annotation is removed, or the whole metdata block is deleted, it will be recreated prior to ingesting.</p>
<h2 id="manual-annotations">Manual annotations</h2>
<p>Manual annotations may be added, if desired, directly in the markdown file by the human RAG author. An annotation is simply a metadata property. To tell the framework that this property is an annotation, you can specify it in config.toml.</p>
<p>For example, here you introduce a manual annotation called 'topic':</p>
<pre><code class="language-markdown">---
topic: 'review'
---

We provide here a reviwe of logistic regression... (further text omitted)

</code></pre>
<p>Then, in config.toml:</p>
<pre><code>[RAG.annotation_model]
own_properties = [&quot;topic&quot;]
</code></pre>
<p>Manual annotations can be "own" or "inherited". Inherited annotations are taken from ancestor nodes, i.e. headings higher in the hierarchy.</p>
<p>All annotations that are included in the annotation model are concatenated together prior to be embedded.</p>
<h2 id="reviewing-annotations">Reviewing annotations</h2>
<p>LM Markdown for Education is designed to allow the RAG author to review all annotations manually prior to ingesting the documents. In the command window, start the LM markdown terminal (this may take some time and require an internet connection, depending on the embedding library in use):</p>
<pre><code class="language-bash">lmme terminal
</code></pre>
<p>This command prints some information on the emebdding configuration of the system and prepares a prompt waiting for commands. These commands work on a file (generally, the file will be open in a markdown editor to view the effects of commands).</p>
<p>To direct the system to create a specific annotation, use the <code>scan_rag</code> command with the annotation that you need to produce. For example, to produce questions for the my_markdown.md document, type</p>
<pre><code class="language-bash">&gt; scan_rag --questions my_markdown.md
</code></pre>
<p>and look in the editor for its effects (type <code>scan_rag --help</code> to get an overview of all subcommands). You can edit the question generated by the language model by typing directly in the markdown editor.</p>
<p>While the <code>ingest</code> command is used to send the file to the vector database, it may also be used to create the annotations specified by the annotation model without ingesting the document. To this end, use it as follows:</p>
<pre><code class="language-bash">&gt; ingest --save_files=true --skip_ingest=true my_markdown.md
</code></pre>
<p>This will prepare the markdown for ingestion without ingesting it, and save it instead to disk for review and editing.</p>
<p>As mentioned, the annotations may be edited manually prior to ingestion. At the time of ingestion, annotations will not be recomputed if the text to which they refer does not change. However, they will after any change to the text to which they refer (that is, under the heading that the metadata block precedes). To prevent annotations from being recomputed when the text changes, add the property <code>frozen</code> to the metadata:</p>
<pre><code class="language-markdown">---
~txthash: S/ec1NIX0xV3NhFFuHY6bQ
titles: Chapter 1 - What are linear model
questions: What are the two main ways linear models are used in practice? - How do linear models relate predictors to an outcome variable? - Why is understanding the output of linear models important for their correct application?  - How do generalizations of linear models enable capturing more complex associations? - In what way does the purpose of a linear model (prediction vs. inference) affect the consideration of confounding factors?
frozen = True
---

Changed text...

</code></pre>
<h2 id="encoding-model">Encoding model</h2>
<p>The encoding model may be specified in the RAG section of config.toml:</p>
<pre><code>[RAG]
encoding_model = &quot;content&quot;
</code></pre>
<p>The possible values of the encoding model are the following.</p>
<table>
<thead>
<tr>
<th>encoding model</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>none</td>
<td>no encoding (chunks identified by their UUID)</td>
</tr>
<tr>
<td>content</td>
<td>encode only textual content in dense vector</td>
</tr>
<tr>
<td>merged</td>
<td>encode textual content merged with metadata in the dense vector</td>
</tr>
<tr>
<td>multivector</td>
<td>encode content and annotations using multiple dense vectors</td>
</tr>
<tr>
<td>sparse</td>
<td>sparse encoding of annotations only (textual content ignored)</td>
</tr>
<tr>
<td>sparse_content</td>
<td>sparse encoding of annotations, dense encoding of content</td>
</tr>
<tr>
<td>sparse_merged</td>
<td>sparse encoding of annotations, dense encoding ofmerged content and annotations</td>
</tr>
<tr>
<td>sparse_multivector</td>
<td>sparse encoding of annotations, content and annotations embedded using multivectors</td>
</tr>
</tbody>
</table>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>