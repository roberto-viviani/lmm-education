
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../chat_stream_adapters/">
      
      
        <link rel="next" href="../vector_store_qdrant_langchain/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Module vector_store_qdrant.py - LM Markdown for Education</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Merriweather";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="slate" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lmm_education.stores.vector_store_qdrant" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LM Markdown for Education" class="md-header__button md-logo" aria-label="LM Markdown for Education" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LM Markdown for Education
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Module vector_store_qdrant.py
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="slate" data-md-color-accent="custom"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LM Markdown for Education" class="md-nav__button md-logo" aria-label="LM Markdown for Education" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    LM Markdown for Education
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Handbook
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Handbook
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Handbook/Installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation and quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Handbook/RAGauthoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    RAG authoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Handbook/Markdown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Working with Markdown
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Handbook/EncodingEmbedding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Encoding and Embedding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Handbook/ChatApp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Main Chatbot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Handbook/Configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Architecture/Overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Architecture/Architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Outline Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Architecture/Implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Outline Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration modules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Configuration/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module config.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Configuration/appchat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module appchat.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Apps
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Apps
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Apps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Apps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Apps/appChat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    App Chat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Apps/appWebcast/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    App Webcast
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Utilities
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appbase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    App Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apputils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    App Utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../background_task_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Background Task Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging_db/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logging DB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    CLI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli_lmme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LMME
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli_terminal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Terminal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    RAG
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    RAG
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scan_rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module scan_rag.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ingest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module ingest.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../querydb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module querydb.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../query/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module query.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    LMM Workflows
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    LMM Workflows
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_1" >
        
          
          <label class="md-nav__link" for="__nav_4_6_1" id="__nav_4_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Workflows and graphs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Workflows and graphs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workflow_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chat_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chat_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workflow_factory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow factory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6_2" >
        
          
          <label class="md-nav__link" for="__nav_4_6_2" id="__nav_4_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Streams
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Streams
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stream_adapters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stream adapters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chat_stream_adapters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chat stream adapters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" checked>
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Vector Stores
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Vector Stores
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Module vector_store_qdrant.py
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Module vector_store_qdrant.py
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant" class="md-nav__link">
    <span class="md-ellipsis">
      
        vector_store_qdrant
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        QdrantEmbeddingModel
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.ainitialize_collection" class="md-nav__link">
    <span class="md-ellipsis">
      
        ainitialize_collection
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.ainitialize_collection_from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        ainitialize_collection_from_config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.aquery" class="md-nav__link">
    <span class="md-ellipsis">
      
        aquery
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.aquery_grouped" class="md-nav__link">
    <span class="md-ellipsis">
      
        aquery_grouped
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.async_client_from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        async_client_from_config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.async_qdrant_client_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        async_qdrant_client_context
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.aupload" class="md-nav__link">
    <span class="md-ellipsis">
      
        aupload
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.chunks_to_points" class="md-nav__link">
    <span class="md-ellipsis">
      
        chunks_to_points
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.client_from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        client_from_config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.encoding_to_qdrantembedding_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        encoding_to_qdrantembedding_model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.groups_to_points" class="md-nav__link">
    <span class="md-ellipsis">
      
        groups_to_points
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.initialize_collection" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize_collection
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.initialize_collection_from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize_collection_from_config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.points_to_blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        points_to_blocks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.points_to_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        points_to_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.points_to_payload" class="md-nav__link">
    <span class="md-ellipsis">
      
        points_to_payload
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.points_to_text" class="md-nav__link">
    <span class="md-ellipsis">
      
        points_to_text
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.qdrant_client_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        qdrant_client_context
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.query" class="md-nav__link">
    <span class="md-ellipsis">
      
        query
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.query_grouped" class="md-nav__link">
    <span class="md-ellipsis">
      
        query_grouped
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.upload" class="md-nav__link">
    <span class="md-ellipsis">
      
        upload
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vector_store_qdrant_langchain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module vector_store_qdrant_langchain.py
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vector_store_qdrant_context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Module vector store context
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vector_store_qdrant_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant" class="md-nav__link">
    <span class="md-ellipsis">
      
        vector_store_qdrant
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        QdrantEmbeddingModel
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.ainitialize_collection" class="md-nav__link">
    <span class="md-ellipsis">
      
        ainitialize_collection
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.ainitialize_collection_from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        ainitialize_collection_from_config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.aquery" class="md-nav__link">
    <span class="md-ellipsis">
      
        aquery
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.aquery_grouped" class="md-nav__link">
    <span class="md-ellipsis">
      
        aquery_grouped
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.async_client_from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        async_client_from_config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.async_qdrant_client_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        async_qdrant_client_context
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.aupload" class="md-nav__link">
    <span class="md-ellipsis">
      
        aupload
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.chunks_to_points" class="md-nav__link">
    <span class="md-ellipsis">
      
        chunks_to_points
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.client_from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        client_from_config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.encoding_to_qdrantembedding_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        encoding_to_qdrantembedding_model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.groups_to_points" class="md-nav__link">
    <span class="md-ellipsis">
      
        groups_to_points
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.initialize_collection" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize_collection
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.initialize_collection_from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize_collection_from_config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.points_to_blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        points_to_blocks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.points_to_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        points_to_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.points_to_payload" class="md-nav__link">
    <span class="md-ellipsis">
      
        points_to_payload
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.points_to_text" class="md-nav__link">
    <span class="md-ellipsis">
      
        points_to_text
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.qdrant_client_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        qdrant_client_context
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.query" class="md-nav__link">
    <span class="md-ellipsis">
      
        query
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.query_grouped" class="md-nav__link">
    <span class="md-ellipsis">
      
        query_grouped
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lmm_education.stores.vector_store_qdrant.upload" class="md-nav__link">
    <span class="md-ellipsis">
      
        upload
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Module vector_store_qdrant.py</h1>

<div class="doc doc-object doc-module">



<a id="lmm_education.stores.vector_store_qdrant"></a>
    <div class="doc doc-contents first">

        <p>Computes the embeddings and handles uploading and saving the data
to the vector database.</p>
<p>This is a low-level module that provides the interface to the qdrant
database, while also bringing it together with the settings informa-
tion in config.toml and an embeddings provider. Exceptions are relayed
to a logger object for use in a REPL interface. A connection to the
database is representend by a <code>QdrantClient</code> object of the Qdrant API,
which may be initialized directly through the constructor, or through
the <code>client_from_config</code> function which reads the database options
from config.toml:</p>
<pre><code class="language-python">    from lmm_education.stores.vector_store_qdrant import client_from_config

    client: QdrantClient | None = client_from_config()
    # check client is not None
</code></pre>
<p>It is also possible to intialize a config object explicitly for the
properties that override config.toml.</p>
<pre><code class="language-python">    from lmm_education.stores.vector_store_qdrant import client_from_config
    from lmm_education.config.config import ConfigSettings

    # read settings from config.toml, but override 'storage':
    settings = ConfigSettings(storage=&quot;:memory:&quot;)
    client: QdrantClient | None = client_from_config(settings)
</code></pre>
<p>(Please also see the vector_store_qdrant_context module to create a
global client object that is automatically closed).</p>
<p>The functions in this module use a logger to communicate errors, so
that the way exceptions are handled depends on the logger type. If no
logger is specified, an error message is printed on the console.</p>
<pre><code class="language-python">    from lmm_education.stores.vector_store_qdrant import client_from_config
    from lmm.utils.logging import LogfileLogger

    logger = LogfileLogger()
    client: QdrantClient | None = client_from_config(None, logger)
    if client is None:
        # read causes from logger
</code></pre>
<p>The role of client_from_config is to bind the creation of a
QdrantClient object with the relevant settings in config.toml, and
channel possible exceptions through the logger. Note, however, that
the QdrantClient can also be created with the qdrant API directly.
Note that in both cases the client needs be closed before exiting.</p>
<p>A slightly more higher-lever alternative is obtaining the client
through a context manager by calling <code>qdrant_client_context</code>:</p>
<pre><code class="language-python">try:
    with qdrant_client_context() as client:
        result_docs = upload(
            client, &quot;documents&quot;, model, settings, doc_chunks
        )
        result_imgs = upload(
            client, &quot;images&quot;, model, settings, img_chunks
        )
except Exception as e:
    .... error handling
</code></pre>
<p>Please note that at present you have to capture errors when using
the context manager.</p>
<p>The remaining functions of the module take the client object to read
and write to the database. All calls go through initialize_collection,
which takes the name of the collection and an embedding model to
specify how the data should be embedded (what type of dense and sparse
vector, or any hybrid combination of those, should be used):</p>
<pre><code class="language-python">    # ... client creation not shown
    from lmm_education.stores.vector_store_qdrant import (
        initialize_collection,
        QdrantEmbeddingModel,
    )

    embedding_model = QdrantEmbeddingModel.DENSE
    flag: bool = initialize_collection(
        client,
        &quot;documents&quot;,
        embedding_model,
        ConfigSettings().embeddings,
        logger=logger)
</code></pre>
<pre><code class="language-python">embedding_model = QdrantEmbeddingModel.DENSE
opts: DatabaseSource = &quot;:memory:&quot;
try:
    with qdrant_client_context(opts) as client:
        result = initialize_collection(
            client,
            &quot;Main&quot;,
            embedding_model,
            ConfigSettings().embeddings,
        )
except Exception as e:
    .... handle exceptions
</code></pre>
<p>In every call to the functions of the module, the client, the
collection name, the embedding model, and the embedding provider
settings are given as arguments.</p>
<p>Data are ingested in the database in the form of lists of <code>Chunk</code>
objects (see the <code>lmm_education.stores.chunks</code> module).</p>
<pre><code class="language-python">points: list[Point] = upload(
    client,
    &quot;documents&quot;,
    embedding_model,
    ConfigSettings().embeddings,
    chunks,
    logger=logger,
)
</code></pre>
<p>The <code>Point</code> objects are the representations of records used by Qdrant.
This function converts each <code>Chunk</code> object to a <code>Point</code> object prior
to ingesting. This conversion includes the formation of dense and
sparse vectors, as specified by the embedding model. The points are
returned if the upload is successful.</p>
<p>The database may then be queried:</p>
<pre><code class="language-python">points: list[ScoredPoint] = query(
    client,
    &quot;documents&quot;,
    embedding_model,
    ConfigSettings().embeddings,
    &quot;What are the main uses of logistic regression?&quot;,
    limit=12,  # max number retrieved points
    payload=True,  # all payload fields
    logger=logger,
)

# retrieve text
for pt in points:
    print(f&quot;{pt.score}
{pt.payload['page_content']}

&quot;)
</code></pre>
<p><code>ScoredPoint</code> is the Qdrant class to return the payload of the
retrieved points (which includes the text).</p>


<details class="responsibilities" open>
  <summary>Responsibilities</summary>
  <p>definition of Qdrant embedding model
compute embeddings
upload data and query</p>
</details>

<details class="main-functions" open>
  <summary>Main functions</summary>
  <p>client_from_config / async_client_from_config
initialize_collection / ainitialize_collection
initialize_collection_from_config / ainitialize_collection_from_config
upload / aupload
query / aquery
query_grouped / aquery_grouped</p>
</details>

<details class="behaviour" open>
  <summary>Behaviour</summary>
  <p>Errors communicated through logger, with the exception of client object
context managers: qdrant_client_context and async_qdrant_client_context</p>
</details>









  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel" class="doc doc-heading">
            <code>QdrantEmbeddingModel</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>



        <p>Enum for embedding strategies</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">QdrantEmbeddingModel</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enum for embedding strategies&quot;&quot;&quot;</span>

    <span class="n">DENSE</span> <span class="o">=</span> <span class="s2">&quot;dense&quot;</span>
    <span class="n">MULTIVECTOR</span> <span class="o">=</span> <span class="s2">&quot;multivector&quot;</span>
    <span class="n">SPARSE</span> <span class="o">=</span> <span class="s2">&quot;sparse&quot;</span>
    <span class="n">HYBRID_DENSE</span> <span class="o">=</span> <span class="s2">&quot;hybrid_dense&quot;</span>
    <span class="n">HYBRID_MULTIVECTOR</span> <span class="o">=</span> <span class="s2">&quot;hybrid_multivector&quot;</span>
    <span class="n">UUID</span> <span class="o">=</span> <span class="s2">&quot;UUID&quot;</span>  <span class="c1"># no embedding</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.ainitialize_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ainitialize_collection</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">qdrant_model</span><span class="p">,</span> <span class="n">embedding_settings</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Check that the collection supports the embedding model, if
already in the database. If not, create a collection supporting
the embedding model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="qdrant_client.AsyncQdrantClient">AsyncQdrantClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>QdrantClient object encapsulating the conn to the db</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the collection</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qdrant_model</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="QdrantEmbeddingModel (lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel)" href="#lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel">QdrantEmbeddingModel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the qdrant embedding model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embedding_settings</code>
            </td>
            <td>
                  <code><span title="lmm.config.config.EmbeddingSettings">EmbeddingSettings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the embedding settings</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a boolean signaling successful initialization and that the
client may be used with these parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>the embedding_settings are required to create an embedding to
    obtain the dense embedding vector length, and record the
    embedding vector length in the schema.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">ainitialize_collection</span><span class="p">(</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">AsyncQdrantClient</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">qdrant_model</span><span class="p">:</span> <span class="n">QdrantEmbeddingModel</span><span class="p">,</span>
    <span class="n">embedding_settings</span><span class="p">:</span> <span class="n">EmbeddingSettings</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check that the collection supports the embedding model, if</span>
<span class="sd">    already in the database. If not, create a collection supporting</span>
<span class="sd">    the embedding model</span>

<span class="sd">    Args:</span>
<span class="sd">        client: QdrantClient object encapsulating the conn to the db</span>
<span class="sd">        collection_name: the collection</span>
<span class="sd">        qdrant_model: the qdrant embedding model</span>
<span class="sd">        embedding_settings: the embedding settings</span>

<span class="sd">    Returns:</span>
<span class="sd">        a boolean signaling successful initialization and that the</span>
<span class="sd">            client may be used with these parameters.</span>

<span class="sd">    Note:</span>
<span class="sd">        the embedding_settings are required to create an embedding to</span>
<span class="sd">            obtain the dense embedding vector length, and record the</span>
<span class="sd">            embedding vector length in the schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">requests.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="ne">ConnectionError</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">lmm.models.langchain.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">create_embeddings</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">encoder</span><span class="p">:</span> <span class="n">Embeddings</span> <span class="o">=</span> <span class="n">create_embeddings</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to language models.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;Check the internet connection.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not create langchain kernel. Check that langchain &quot;</span>
            <span class="s2">&quot;is installed, and an internet connection is available.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not initialize language model engine:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">collection_exists</span><span class="p">(</span><span class="n">collection_name</span><span class="p">):</span>
            <span class="n">info</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">params</span>  <span class="c1"># noqa  # type: ignore</span>

            <span class="c1"># checks that the opts and the collection</span>
            <span class="c1"># are compatible</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">acheck_schema</span><span class="p">(</span>
                <span class="n">client</span><span class="p">,</span>
                <span class="n">collection_name</span><span class="p">,</span>
                <span class="n">qdrant_model</span><span class="p">,</span>
                <span class="n">embedding_settings</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># determine embedding size</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="n">qdrant_model</span> <span class="o">==</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">UUID</span>
            <span class="ow">or</span> <span class="n">qdrant_model</span> <span class="o">==</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">SPARSE</span>
        <span class="p">):</span>
            <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">encoder</span><span class="o">.</span><span class="n">aembed_query</span><span class="p">(</span>
                <span class="s2">&quot;Test query&quot;</span>
            <span class="p">)</span>
            <span class="n">embedding_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">embedding_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">match</span> <span class="n">qdrant_model</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">vectors_config</span><span class="o">=</span><span class="p">{}</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">DENSE</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">DENSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">VectorParams</span><span class="p">(</span>
                            <span class="n">size</span><span class="o">=</span><span class="n">embedding_size</span><span class="p">,</span>
                            <span class="n">distance</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">COSINE</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">MULTIVECTOR</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">DENSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">VectorParams</span><span class="p">(</span>
                            <span class="n">size</span><span class="o">=</span><span class="n">embedding_size</span><span class="p">,</span>
                            <span class="n">distance</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">COSINE</span><span class="p">,</span>
                            <span class="n">multivector_config</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MultiVectorConfig</span><span class="p">(</span>
                                <span class="n">comparator</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MultiVectorComparator</span><span class="o">.</span><span class="n">MAX_SIM</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">SPARSE</span><span class="p">:</span>
                <span class="c1"># TO DO: indices</span>
                <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">vectors_config</span><span class="o">=</span><span class="p">{},</span>
                    <span class="n">sparse_vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">SPARSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVectorParams</span><span class="p">()</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_DENSE</span><span class="p">:</span>
                <span class="c1"># TO DO: indices</span>
                <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">DENSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">VectorParams</span><span class="p">(</span>
                            <span class="n">size</span><span class="o">=</span><span class="n">embedding_size</span><span class="p">,</span>
                            <span class="n">distance</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">COSINE</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">},</span>
                    <span class="n">sparse_vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">SPARSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVectorParams</span><span class="p">()</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_MULTIVECTOR</span><span class="p">:</span>
                <span class="c1"># TO DO: indices</span>
                <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">DENSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">VectorParams</span><span class="p">(</span>
                            <span class="n">size</span><span class="o">=</span><span class="n">embedding_size</span><span class="p">,</span>
                            <span class="n">distance</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">COSINE</span><span class="p">,</span>
                            <span class="n">multivector_config</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MultiVectorConfig</span><span class="p">(</span>
                                <span class="n">comparator</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MultiVectorComparator</span><span class="o">.</span><span class="n">MAX_SIM</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                    <span class="p">},</span>
                    <span class="n">sparse_vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">SPARSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVectorParams</span><span class="p">()</span>
                    <span class="p">},</span>
                <span class="p">)</span>

            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Unreachable code reached due to invalid &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;embedding model: &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qdrant_model</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to the qdrant server, which may be down.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="n">UnexpectedResponse</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not initialize </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="n">ApiException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not initialize </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2"> due to API error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not initialize </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># register the schema</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">acheck_schema</span><span class="p">(</span>
            <span class="n">client</span><span class="p">,</span>
            <span class="n">collection_name</span><span class="p">,</span>
            <span class="n">qdrant_model</span><span class="p">,</span>
            <span class="n">embedding_settings</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unepected error: </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2"> was&quot;</span>
            <span class="s2">&quot;initialized, but the schema could not be&quot;</span>
            <span class="s2">&quot;registered.</span><span class="se">\n</span><span class="s2">Call initialize_collection again to&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;attempt to record schema. Reason for the failure:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># return True nevertheless</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.ainitialize_collection_from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ainitialize_collection_from_config</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>See ainitialize_collection</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">ainitialize_collection_from_config</span><span class="p">(</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">AsyncQdrantClient</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">opts</span><span class="p">:</span> <span class="n">ConfigSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;See ainitialize_collection&quot;&quot;&quot;</span>
    <span class="n">opts</span> <span class="o">=</span> <span class="n">opts</span> <span class="ow">or</span> <span class="n">load_settings</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not initialize client due to invalid &quot;</span> <span class="s2">&quot;settings.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">collection_name</span><span class="p">:</span>
        <span class="n">collection_name</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">collection_name</span>

    <span class="k">return</span> <span class="k">await</span> <span class="n">ainitialize_collection</span><span class="p">(</span>
        <span class="n">client</span><span class="p">,</span>
        <span class="n">collection_name</span><span class="p">,</span>
        <span class="n">encoding_to_qdrantembedding_model</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">RAG</span><span class="o">.</span><span class="n">encoding_model</span><span class="p">),</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">embeddings</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.aquery" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aquery</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">qdrant_model</span><span class="p">,</span> <span class="n">embedding_settings</span><span class="p">,</span> <span class="n">querytext</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;page_content&#39;</span><span class="p">],</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Executes a query on the client asynchronously.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="qdrant_client.AsyncQdrantClient">AsyncQdrantClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a QdrantClient object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the collection to query</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qdrant_model</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="QdrantEmbeddingModel (lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel)" href="#lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel">QdrantEmbeddingModel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the qdrant embedding model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embedding_settings</code>
            </td>
            <td>
                  <code><span title="lmm.config.config.EmbeddingSettings">EmbeddingSettings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the embedding settings</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>querytext</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the target text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>max number of chunks retrieved</p>
              </div>
            </td>
            <td>
                  <code>12</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>payload</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | <span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>what properties to be retrieved; defaults to the text
retrieved for similarity to the querytext</p>
              </div>
            </td>
            <td>
                  <code>[&#39;page_content&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="lmm.utils.logging.LoggerBase">LoggerBase</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a logger object</p>
              </div>
            </td>
            <td>
                  <code><span title="lmm_education.stores.vector_store_qdrant.default_logger">default_logger</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="qdrant_client.models.ScoredPoint">ScoredPoint</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of ScoredPoint objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">aquery</span><span class="p">(</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">AsyncQdrantClient</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">qdrant_model</span><span class="p">:</span> <span class="n">QdrantEmbeddingModel</span><span class="p">,</span>
    <span class="n">embedding_settings</span><span class="p">:</span> <span class="n">EmbeddingSettings</span><span class="p">,</span>
    <span class="n">querytext</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
    <span class="n">payload</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;page_content&#39;</span><span class="p">],</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoredPoint</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a query on the client asynchronously.</span>

<span class="sd">    Args:</span>
<span class="sd">        client: a QdrantClient object</span>
<span class="sd">        collection_name: the collection to query</span>
<span class="sd">        qdrant_model: the qdrant embedding model</span>
<span class="sd">        embedding_settings: the embedding settings</span>
<span class="sd">        querytext: the target text</span>
<span class="sd">        limit: max number of chunks retrieved</span>
<span class="sd">        payload: what properties to be retrieved; defaults to the text</span>
<span class="sd">            retrieved for similarity to the querytext</span>
<span class="sd">        logger: a logger object</span>

<span class="sd">    Returns:</span>
<span class="sd">        a list of ScoredPoint objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># load language model</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">requests.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="ne">ConnectionError</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">lmm.models.langchain.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">create_embeddings</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">encoder</span><span class="p">:</span> <span class="n">Embeddings</span> <span class="o">=</span> <span class="n">create_embeddings</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to language models.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;Check the internet connection.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not create langchain kernel. Check that langchain &quot;</span>
            <span class="s2">&quot;is installed, and an internet connection is available.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not initialize language model engine:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">response</span><span class="p">:</span> <span class="n">QdrantResponse</span> <span class="o">=</span> <span class="n">QdrantResponse</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">[])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">match</span> <span class="n">qdrant_model</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
                <span class="n">records</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Record</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">querytext</span><span class="p">],</span>
                    <span class="n">with_payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoredPoint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">ScoredPoint</span><span class="p">(</span>
                        <span class="nb">id</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="mi">1</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">records</span>
                <span class="p">]</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">QdrantResponse</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">DENSE</span><span class="p">:</span>
                <span class="n">vect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">encoder</span><span class="o">.</span><span class="n">aembed_query</span><span class="p">(</span>
                    <span class="n">querytext</span>
                <span class="p">)</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">vect</span><span class="p">,</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;with_payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">MULTIVECTOR</span><span class="p">:</span>
                <span class="n">vect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">encoder</span><span class="o">.</span><span class="n">aembed_query</span><span class="p">(</span>
                    <span class="n">querytext</span>
                <span class="p">)</span>
                <span class="n">multi_vect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">vect</span><span class="p">,</span> <span class="n">vect</span><span class="p">]</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">multi_vect</span><span class="p">,</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;with_payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">SPARSE</span><span class="p">:</span>
                <span class="n">sparse_model</span> <span class="o">=</span> <span class="n">_get_sparse_model</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
                <span class="n">sparse_embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
                        <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">SPARSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;with_payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_DENSE</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">encoder</span><span class="o">.</span><span class="n">aembed_query</span><span class="p">(</span>
                        <span class="n">querytext</span>
                    <span class="p">)</span>
                    <span class="n">sparse_model</span> <span class="o">=</span> <span class="n">_get_sparse_model</span><span class="p">(</span>
                        <span class="n">embedding_settings</span>
                    <span class="p">)</span>
                    <span class="n">sparse_embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not create encoding&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">[]</span>
                <span class="n">dense_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">vect</span><span class="p">,</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">sparse_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
                        <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">SPARSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;prefetch&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">dense_dict</span><span class="p">),</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">sparse_dict</span><span class="p">),</span>
                    <span class="p">],</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">FusionQuery</span><span class="p">(</span>
                        <span class="n">fusion</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Fusion</span><span class="o">.</span><span class="n">RRF</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;with_payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_MULTIVECTOR</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">encoder</span><span class="o">.</span><span class="n">aembed_query</span><span class="p">(</span>
                        <span class="n">querytext</span>
                    <span class="p">)</span>
                    <span class="n">sparse_model</span> <span class="o">=</span> <span class="n">_get_sparse_model</span><span class="p">(</span>
                        <span class="n">embedding_settings</span>
                    <span class="p">)</span>
                    <span class="n">sparse_embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not create encoding&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">[]</span>
                <span class="n">dense_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">vect</span><span class="p">,</span> <span class="n">vect</span><span class="p">],</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">sparse_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
                        <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">SPARSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;prefetch&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">dense_dict</span><span class="p">),</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">sparse_dict</span><span class="p">),</span>
                    <span class="p">],</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">FusionQuery</span><span class="p">(</span>
                        <span class="n">fusion</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Fusion</span><span class="o">.</span><span class="n">RRF</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;with_payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Unreachable code reached due to invalid &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;embedding model: &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qdrant_model</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to the qdrant server, which may be down.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="n">UnexpectedResponse</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not read from the vector database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="n">ApiException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not read from the database due to API error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not read from the database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.aquery_grouped" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aquery_grouped</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">group_collection</span><span class="p">,</span> <span class="n">qdrant_model</span><span class="p">,</span> <span class="n">embedding_settings</span><span class="p">,</span> <span class="n">querytext</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">group_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">group_field</span><span class="o">=</span><span class="n">GROUP_UUID_KEY</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Executes a grouped query on the client asynchronously.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="qdrant_client.AsyncQdrantClient">AsyncQdrantClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a QdrantClient object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the collection to query</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>group_collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the companion collection that will provide
the output of the query</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qdrant_model</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="QdrantEmbeddingModel (lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel)" href="#lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel">QdrantEmbeddingModel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the qdrant embedding model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embedding_settings</code>
            </td>
            <td>
                  <code><span title="lmm.config.config.EmbeddingSettings">EmbeddingSettings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the embedding settings</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>group_field</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the filed to group on</p>
              </div>
            </td>
            <td>
                  <code><span title="lmm.scan.scan_keys.GROUP_UUID_KEY">GROUP_UUID_KEY</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>querytext</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the target text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>max number of chunks retrieved</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>payload</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | <span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>what properties to be retrieved; defaults to all
metadata properties. Note that text is 'page_content', and
this will be included unless payload = False
If payload = True, all propertes are included.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>group_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>max retrieved output from the group collection</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>group_field</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the filed to group on</p>
              </div>
            </td>
            <td>
                  <code><span title="lmm.scan.scan_keys.GROUP_UUID_KEY">GROUP_UUID_KEY</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="lmm.utils.logging.LoggerBase">LoggerBase</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a logger object</p>
              </div>
            </td>
            <td>
                  <code><span title="lmm_education.stores.vector_store_qdrant.default_logger">default_logger</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="qdrant_client.models.GroupsResult">GroupsResult</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of ScoredPoint objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">aquery_grouped</span><span class="p">(</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">AsyncQdrantClient</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">group_collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">qdrant_model</span><span class="p">:</span> <span class="n">QdrantEmbeddingModel</span><span class="p">,</span>
    <span class="n">embedding_settings</span><span class="p">:</span> <span class="n">EmbeddingSettings</span><span class="p">,</span>
    <span class="n">querytext</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">payload</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">group_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">group_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">GROUP_UUID_KEY</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GroupsResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a grouped query on the client asynchronously.</span>

<span class="sd">    Args:</span>
<span class="sd">        client: a QdrantClient object</span>
<span class="sd">        collection_name: the collection to query</span>
<span class="sd">        group_collection: the companion collection that will provide</span>
<span class="sd">            the output of the query</span>
<span class="sd">        qdrant_model: the qdrant embedding model</span>
<span class="sd">        embedding_settings: the embedding settings</span>
<span class="sd">        group_field: the filed to group on</span>
<span class="sd">        querytext: the target text</span>
<span class="sd">        limit: max number of chunks retrieved</span>
<span class="sd">        payload: what properties to be retrieved; defaults to all</span>
<span class="sd">            metadata properties. Note that text is &#39;page_content&#39;, and</span>
<span class="sd">            this will be included unless payload = False</span>
<span class="sd">            If payload = True, all propertes are included.</span>
<span class="sd">        group_size: max retrieved output from the group collection</span>
<span class="sd">        group_field: the filed to group on</span>
<span class="sd">        logger: a logger object</span>

<span class="sd">    Returns:</span>
<span class="sd">        a list of ScoredPoint objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure if payload is given, it contains `page_content`</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;page_content&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
            <span class="n">payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;page_content&#39;</span><span class="p">)</span>

    <span class="c1"># Essentially, the qdrant API declares different</span>
    <span class="c1"># types for any search API.</span>
    <span class="n">NullResult</span><span class="p">:</span> <span class="n">GroupsResult</span> <span class="o">=</span> <span class="n">GroupsResult</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="p">[])</span>
    <span class="c1"># load language model</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">requests.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="ne">ConnectionError</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">lmm.models.langchain.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">create_embeddings</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">encoder</span><span class="p">:</span> <span class="n">Embeddings</span> <span class="o">=</span> <span class="n">create_embeddings</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to language models.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;Check the internet connection.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not create langchain kernel. Check that langchain &quot;</span>
            <span class="s2">&quot;is installed, and an internet connection is available.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not initialize language model engine:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>

    <span class="n">response</span><span class="p">:</span> <span class="n">GroupsResult</span> <span class="o">=</span> <span class="n">NullResult</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">match</span> <span class="n">qdrant_model</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
                <span class="c1"># ignore grouping</span>
                <span class="n">hits</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoredPoint</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">aquery</span><span class="p">(</span>
                    <span class="n">client</span><span class="p">,</span>
                    <span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">qdrant_model</span><span class="p">,</span>
                    <span class="n">embedding_settings</span><span class="p">,</span>
                    <span class="n">querytext</span><span class="p">,</span>
                    <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                    <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">GroupsResult</span><span class="p">(</span>
                    <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="n">PointGroup</span><span class="p">(</span><span class="n">hits</span><span class="o">=</span><span class="n">hits</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">querytext</span><span class="p">)]</span>
                <span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">DENSE</span><span class="p">:</span>
                <span class="n">vect</span> <span class="o">=</span> <span class="k">await</span> <span class="n">encoder</span><span class="o">.</span><span class="n">aembed_query</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">vect</span><span class="p">,</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;group_by&#39;</span><span class="p">:</span> <span class="n">group_field</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                    <span class="s1">&#39;group_size&#39;</span><span class="p">:</span> <span class="n">group_size</span><span class="p">,</span>
                    <span class="s1">&#39;with_lookup&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">WithLookup</span><span class="p">(</span>
                        <span class="n">collection</span><span class="o">=</span><span class="n">group_collection</span><span class="p">,</span>
                        <span class="n">with_payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                        <span class="n">with_vectors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points_groups</span><span class="p">(</span>
                    <span class="o">**</span><span class="n">query_dict</span>
                <span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">MULTIVECTOR</span><span class="p">:</span>
                <span class="n">vect</span> <span class="o">=</span> <span class="k">await</span> <span class="n">encoder</span><span class="o">.</span><span class="n">aembed_query</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">vect</span><span class="p">,</span> <span class="n">vect</span><span class="p">],</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;group_by&#39;</span><span class="p">:</span> <span class="n">group_field</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                    <span class="s1">&#39;group_size&#39;</span><span class="p">:</span> <span class="n">group_size</span><span class="p">,</span>
                    <span class="s1">&#39;with_lookup&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">WithLookup</span><span class="p">(</span>
                        <span class="n">collection</span><span class="o">=</span><span class="n">group_collection</span><span class="p">,</span>
                        <span class="n">with_payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                        <span class="n">with_vectors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points_groups</span><span class="p">(</span>
                    <span class="o">**</span><span class="n">query_dict</span>
                <span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">SPARSE</span><span class="p">:</span>
                <span class="n">sparse_model</span><span class="p">:</span> <span class="n">SparseTextEmbedding</span> <span class="o">=</span> <span class="n">_get_sparse_model</span><span class="p">(</span>
                    <span class="n">embedding_settings</span>
                <span class="p">)</span>
                <span class="n">sparse_embeddings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SparseEmbedding</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
                        <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">SPARSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;group_by&#39;</span><span class="p">:</span> <span class="n">group_field</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                    <span class="s1">&#39;group_size&#39;</span><span class="p">:</span> <span class="n">group_size</span><span class="p">,</span>
                    <span class="s1">&#39;with_lookup&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">WithLookup</span><span class="p">(</span>
                        <span class="n">collection</span><span class="o">=</span><span class="n">group_collection</span><span class="p">,</span>
                        <span class="n">with_payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                        <span class="n">with_vectors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points_groups</span><span class="p">(</span>
                    <span class="o">**</span><span class="n">query_dict</span>
                <span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_DENSE</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">encoder</span><span class="o">.</span><span class="n">aembed_query</span><span class="p">(</span>
                        <span class="n">querytext</span>
                    <span class="p">)</span>
                    <span class="n">sparse_model</span><span class="p">:</span> <span class="n">SparseTextEmbedding</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">_get_sparse_model</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">sparse_embeddings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SparseEmbedding</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not create encoding&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">NullResult</span>
                <span class="n">dense_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">vect</span><span class="p">,</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">sparse_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
                        <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">SPARSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;prefetch&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">dense_dict</span><span class="p">),</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">sparse_dict</span><span class="p">),</span>
                    <span class="p">],</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">FusionQuery</span><span class="p">(</span>
                        <span class="n">fusion</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Fusion</span><span class="o">.</span><span class="n">RRF</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;group_by&#39;</span><span class="p">:</span> <span class="n">group_field</span><span class="p">,</span>
                    <span class="s1">&#39;group_size&#39;</span><span class="p">:</span> <span class="n">group_size</span><span class="p">,</span>
                    <span class="s1">&#39;with_lookup&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">WithLookup</span><span class="p">(</span>
                        <span class="n">collection</span><span class="o">=</span><span class="n">group_collection</span><span class="p">,</span>
                        <span class="n">with_payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                        <span class="n">with_vectors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points_groups</span><span class="p">(</span>
                    <span class="o">**</span><span class="n">query_dict</span>
                <span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_MULTIVECTOR</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">encoder</span><span class="o">.</span><span class="n">aembed_query</span><span class="p">(</span>
                        <span class="n">querytext</span>
                    <span class="p">)</span>
                    <span class="n">sparse_model</span><span class="p">:</span> <span class="n">SparseTextEmbedding</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">_get_sparse_model</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">sparse_embeddings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SparseEmbedding</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not create encoding&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">NullResult</span>
                <span class="n">dense_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">vect</span><span class="p">,</span> <span class="n">vect</span><span class="p">],</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">sparse_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
                        <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">SPARSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;prefetch&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">dense_dict</span><span class="p">),</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">sparse_dict</span><span class="p">),</span>
                    <span class="p">],</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">FusionQuery</span><span class="p">(</span>
                        <span class="n">fusion</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Fusion</span><span class="o">.</span><span class="n">RRF</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;group_by&#39;</span><span class="p">:</span> <span class="n">group_field</span><span class="p">,</span>
                    <span class="s1">&#39;group_size&#39;</span><span class="p">:</span> <span class="n">group_size</span><span class="p">,</span>
                    <span class="s1">&#39;with_lookup&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">WithLookup</span><span class="p">(</span>
                        <span class="n">collection</span><span class="o">=</span><span class="n">group_collection</span><span class="p">,</span>
                        <span class="n">with_payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                        <span class="n">with_vectors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points_groups</span><span class="p">(</span>
                    <span class="o">**</span><span class="n">query_dict</span>
                <span class="p">)</span>

            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Unreachable code reached due to invalid &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;embedding model: &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qdrant_model</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to the qdrant server, which may be down.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>
    <span class="k">except</span> <span class="n">UnexpectedResponse</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not read from the vector database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>
    <span class="k">except</span> <span class="n">ApiException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not read from the database due to API error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not read from the database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.async_client_from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">async_client_from_config</span><span class="p">(</span><span class="n">opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a qdrant clients from config settings. Reads from config
toml file settings if none given.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opts</code>
            </td>
            <td>
                  <code><span title="lmm_education.config.config.DatabaseSource">DatabaseSource</span> | <a class="autorefs autorefs-internal" title="ConfigSettings (lmm_education.config.config.ConfigSettings)" href="../Configuration/config/#lmm_education.config.config.ConfigSettings">ConfigSettings</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the config settings</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="lmm.utils.logging.LoggerBase">LoggerBase</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a logger object</p>
              </div>
            </td>
            <td>
                  <code><span title="lmm_education.stores.vector_store_qdrant.default_logger">default_logger</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="qdrant_client.AsyncQdrantClient">AsyncQdrantClient</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a QdrantClient object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">async_client_from_config</span><span class="p">(</span>
    <span class="n">opts</span><span class="p">:</span> <span class="n">DatabaseSource</span> <span class="o">|</span> <span class="n">ConfigSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncQdrantClient</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a qdrant clients from config settings. Reads from config</span>
<span class="sd">    toml file settings if none given.</span>

<span class="sd">    Args:</span>
<span class="sd">        opts: the config settings</span>
<span class="sd">        logger: a logger object</span>

<span class="sd">    Returns:</span>
<span class="sd">        a QdrantClient object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">lmm_education.config.config</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">LocalStorage</span><span class="p">,</span>
        <span class="n">RemoteSource</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">opts</span> <span class="o">=</span> <span class="n">opts</span> <span class="ow">or</span> <span class="n">load_settings</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not initialize client due to invalid settings.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">opts_storage</span><span class="p">:</span> <span class="n">DatabaseSource</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">storage</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">ConfigSettings</span><span class="p">)</span> <span class="k">else</span> <span class="n">opts</span>
        <span class="p">)</span>

        <span class="n">client</span><span class="p">:</span> <span class="n">AsyncQdrantClient</span>
        <span class="k">match</span> <span class="n">opts_storage</span><span class="p">:</span>
            <span class="k">case</span> <span class="s1">&#39;:memory:&#39;</span><span class="p">:</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">AsyncQdrantClient</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
            <span class="k">case</span> <span class="n">LocalStorage</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">):</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">AsyncQdrantClient</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">case</span> <span class="n">RemoteSource</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">):</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">AsyncQdrantClient</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid database source&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to the qdrant server, which may be down.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="n">UnexpectedResponse</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not initialize qdrant client: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="n">ApiException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not initialize qdrant client due to API error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># This often caused by accessing qdrant with async client after</span>
        <span class="c1"># prior acces with sync client</span>
        <span class="k">if</span> <span class="s2">&quot;aready accessed&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not initialize qdrant client due to &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;previous sync initialization?</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not initialize qdrant client due to &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;runtime error:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not initialize qdrant client:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">client</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.async_qdrant_client_context" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">async_qdrant_client_context</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Contructs an asynchronous client object within a context
manager.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="lmm_education.config.config.DatabaseSource">DatabaseSource</span> | <a class="autorefs autorefs-internal" title="ConfigSettings (lmm_education.config.config.ConfigSettings)" href="../Configuration/config/#lmm_education.config.config.ConfigSettings">ConfigSettings</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specification of the database. If none, settings
from config.toml will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="lmm.utils.logging.LoggerBase">LoggerBase</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a logger object.</p>
              </div>
            </td>
            <td>
                  <code><span title="lmm_education.stores.vector_store_qdrant.default_logger">default_logger</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.AsyncGenerator">AsyncGenerator</span>[<span title="qdrant_client.AsyncQdrantClient">AsyncQdrantClient</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a client object context.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="behaviour" open>
  <summary>Behaviour</summary>
  <p>Raises ConnectionError if client initialization fails.
This is standard behavior for context managers.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@asynccontextmanager</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">async_qdrant_client_context</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">DatabaseSource</span> <span class="o">|</span> <span class="n">ConfigSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">AsyncQdrantClient</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Contructs an asynchronous client object within a context</span>
<span class="sd">    manager.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: specification of the database. If none, settings</span>
<span class="sd">            from config.toml will be used.</span>
<span class="sd">        logger: a logger object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        a client object context.</span>

<span class="sd">    Behaviour:</span>
<span class="sd">        Raises ConnectionError if client initialization fails.</span>
<span class="sd">        This is standard behavior for context managers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">async_client_from_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to create Qdrant client&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Failed to create Qdrant client&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">client</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing client: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.aupload" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aupload</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">qdrant_model</span><span class="p">,</span> <span class="n">embedding_settings</span><span class="p">,</span> <span class="n">chunks</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Upload a list of chunks into the Qdrant database</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="qdrant_client.AsyncQdrantClient">AsyncQdrantClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the connection to the database</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the collection</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qdrant_model</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="QdrantEmbeddingModel (lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel)" href="#lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel">QdrantEmbeddingModel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the qdrant embedding model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embedding_settings</code>
            </td>
            <td>
                  <code><span title="lmm.config.config.EmbeddingSettings">EmbeddingSettings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the embedding settings</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="lmm.scan.chunks.Chunk">Chunk</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the chunk list</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="qdrant_client.models.PointStruct">PointStruct</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of Point objects</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">aupload</span><span class="p">(</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">AsyncQdrantClient</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">qdrant_model</span><span class="p">:</span> <span class="n">QdrantEmbeddingModel</span><span class="p">,</span>
    <span class="n">embedding_settings</span><span class="p">:</span> <span class="n">EmbeddingSettings</span><span class="p">,</span>
    <span class="n">chunks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Chunk</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload a list of chunks into the Qdrant database</span>

<span class="sd">    Args:</span>
<span class="sd">        client: the connection to the database</span>
<span class="sd">        collection_name: the collection</span>
<span class="sd">        qdrant_model: the qdrant embedding model</span>
<span class="sd">        embedding_settings: the embedding settings</span>
<span class="sd">        chunks: the chunk list</span>

<span class="sd">    Returns:</span>
<span class="sd">        a list of Point objects</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">ainitialize_collection</span><span class="p">(</span>
        <span class="n">client</span><span class="p">,</span>
        <span class="n">collection_name</span><span class="p">,</span>
        <span class="n">qdrant_model</span><span class="p">,</span>
        <span class="n">embedding_settings</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not initialize collection&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunks_to_points</span><span class="p">(</span>
        <span class="n">chunks</span><span class="p">,</span> <span class="n">qdrant_model</span><span class="p">,</span> <span class="n">embedding_settings</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">points</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">upsert</span><span class="p">(</span>
            <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="n">points</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to the qdrant server, which may be down.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="n">UnexpectedResponse</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to vector database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="n">ApiException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not write to database due to API error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not upload chunks to database:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">return</span> <span class="n">points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.chunks_to_points" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">chunks_to_points</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">qdrant_model</span><span class="p">,</span> <span class="n">embedding_settings</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">,</span> <span class="n">chunk_to_payload</span><span class="o">=</span><span class="n">_chunk_to_payload_langchain</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Converts a list of chunks into a list of the record objects
understood by the Qdrant database, using an embedding model
for the conversion.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>chunks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="lmm.scan.chunks.Chunk">Chunk</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the chunks list</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qdrant_model</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="QdrantEmbeddingModel (lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel)" href="#lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel">QdrantEmbeddingModel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the embedding model, or a ConfigSettings object from
which the model may be deduced</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embedding_settings</code>
            </td>
            <td>
                  <code><span title="lmm.config.config.EmbeddingSettings">EmbeddingSettings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the embedding settings</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="lmm.utils.logging.LoggerBase">LoggerBase</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a logger object</p>
              </div>
            </td>
            <td>
                  <code><span title="lmm_education.stores.vector_store_qdrant.default_logger">default_logger</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunk_to_payload</code>
            </td>
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[[<span title="lmm.scan.chunks.Chunk">Chunk</span>], <span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a function to map chunks to the Langchain
representation (internal use)</p>
              </div>
            </td>
            <td>
                  <code><span title="lmm_education.stores.vector_store_qdrant._chunk_to_payload_langchain">_chunk_to_payload_langchain</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="qdrant_client.models.PointStruct">PointStruct</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of Point objects (PointStruct)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">chunks_to_points</span><span class="p">(</span>
    <span class="n">chunks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Chunk</span><span class="p">],</span>
    <span class="n">qdrant_model</span><span class="p">:</span> <span class="n">QdrantEmbeddingModel</span><span class="p">,</span>
    <span class="n">embedding_settings</span><span class="p">:</span> <span class="n">EmbeddingSettings</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
    <span class="n">chunk_to_payload</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span>
        <span class="p">[</span><span class="n">Chunk</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">_chunk_to_payload_langchain</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a list of chunks into a list of the record objects</span>
<span class="sd">    understood by the Qdrant database, using an embedding model</span>
<span class="sd">    for the conversion.</span>

<span class="sd">    Args:</span>
<span class="sd">        chunks: the chunks list</span>
<span class="sd">        qdrant_model: the embedding model, or a ConfigSettings object from</span>
<span class="sd">            which the model may be deduced</span>
<span class="sd">        embedding_settings: the embedding settings</span>
<span class="sd">        logger: a logger object</span>
<span class="sd">        chunk_to_payload: a function to map chunks to the Langchain</span>
<span class="sd">            representation (internal use)</span>

<span class="sd">    Returns:</span>
<span class="sd">        a list of Point objects (PointStruct)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Note: no async version as there is no I/O</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">chunks</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># load embedding model</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">requests.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="ne">ConnectionError</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">lmm.models.langchain.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">create_embeddings</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># if embeddings_model is None, read from config.toml</span>
        <span class="n">encoder</span><span class="p">:</span> <span class="n">Embeddings</span> <span class="o">=</span> <span class="n">create_embeddings</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to language models.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;Check the internet connection.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not create langchain kernel. Check that langchain &quot;</span>
            <span class="s2">&quot;is installed, and an internet connection is available.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not initialize language model engine:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># the payload saved in the database is given by chunk_to_payload,</span>
    <span class="c1"># the emmbedding by the embedding model</span>
    <span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">match</span> <span class="n">qdrant_model</span><span class="p">:</span>
        <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">Point</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span> <span class="n">vector</span><span class="o">=</span><span class="p">{},</span> <span class="n">payload</span><span class="o">=</span><span class="n">chunk_to_payload</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">chunks</span>
            <span class="p">]</span>

        <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">DENSE</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vect</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">dense_encoding</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not create encoding&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">Point</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
                    <span class="n">vector</span><span class="o">=</span><span class="p">{</span><span class="n">DENSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">v</span><span class="p">},</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">chunk_to_payload</span><span class="p">(</span><span class="n">d</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">vect</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">MULTIVECTOR</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vect</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">encoder</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">annotations</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">encoder</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">dense_encoding</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">]</span>
                    <span class="p">),</span>
                <span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not create encoding&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">Point</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
                    <span class="n">vector</span><span class="o">=</span><span class="p">{</span><span class="n">DENSE_VECTOR_NAME</span><span class="p">:</span> <span class="p">[</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">]},</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">chunk_to_payload</span><span class="p">(</span><span class="n">d</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">vect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vect</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">]</span>

        <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">SPARSE</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sparse_model</span> <span class="o">=</span> <span class="n">_get_sparse_model</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
                <span class="n">sparse_embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">sparse_encoding</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not create encoding&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">Point</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
                    <span class="n">vector</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">SPARSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                            <span class="n">indices</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                            <span class="n">values</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="p">)</span>
                    <span class="p">},</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">chunk_to_payload</span><span class="p">(</span><span class="n">d</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">sparse_embeddings</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_DENSE</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vect</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">dense_encoding</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">sparse_model</span> <span class="o">=</span> <span class="n">_get_sparse_model</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
                <span class="n">sparse_embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">sparse_encoding</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not create encoding&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">Point</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
                    <span class="n">vector</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">DENSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span>
                        <span class="n">SPARSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                            <span class="n">indices</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                            <span class="n">values</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="p">),</span>
                    <span class="p">},</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">chunk_to_payload</span><span class="p">(</span><span class="n">d</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">vect</span><span class="p">,</span> <span class="n">sparse_embeddings</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_MULTIVECTOR</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vect</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">encoder</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">annotations</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">encoder</span><span class="o">.</span><span class="n">embed_documents</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">dense_encoding</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">]</span>
                    <span class="p">),</span>
                <span class="p">]</span>
                <span class="n">sparse_model</span> <span class="o">=</span> <span class="n">_get_sparse_model</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
                <span class="n">sparse_embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">sparse_encoding</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not create encoding&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">Point</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
                    <span class="n">vector</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">DENSE_VECTOR_NAME</span><span class="p">:</span> <span class="p">[</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">],</span>
                        <span class="n">SPARSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                            <span class="n">indices</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                            <span class="n">values</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="p">),</span>
                    <span class="p">},</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">chunk_to_payload</span><span class="p">(</span><span class="n">d</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="n">chunks</span><span class="p">,</span> <span class="n">vect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vect</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sparse_embeddings</span>
                <span class="p">)</span>
            <span class="p">]</span>

        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Unreachable code reached due to invalid &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;embedding model: &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qdrant_model</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="c1"># This should not happen, but it is important to check</span>
    <span class="c1"># as there will be no way to detect the origin of problems</span>
    <span class="c1"># at query time.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">SystemError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unexpected failure in generating &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Qdrant points: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2"> points for &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s2"> chunks &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(qdrant embedding model: </span><span class="si">{</span><span class="n">qdrant_model</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.client_from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">client_from_config</span><span class="p">(</span><span class="n">opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create a qdrant clients from config settings. Reads from config
toml file settings if none given.</p>
<p>Please note that a client should be closed before exiting.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opts</code>
            </td>
            <td>
                  <code><span title="lmm_education.config.config.DatabaseSource">DatabaseSource</span> | <a class="autorefs autorefs-internal" title="ConfigSettings (lmm_education.config.config.ConfigSettings)" href="../Configuration/config/#lmm_education.config.config.ConfigSettings">ConfigSettings</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the config settings</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="lmm.utils.logging.LoggerBase">LoggerBase</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a logger object</p>
              </div>
            </td>
            <td>
                  <code><span title="lmm_education.stores.vector_store_qdrant.default_logger">default_logger</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="qdrant_client.QdrantClient">QdrantClient</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a QdrantClient object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">client_from_config</span><span class="p">(</span>
    <span class="n">opts</span><span class="p">:</span> <span class="n">DatabaseSource</span> <span class="o">|</span> <span class="n">ConfigSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QdrantClient</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a qdrant clients from config settings. Reads from config</span>
<span class="sd">    toml file settings if none given.</span>

<span class="sd">    Please note that a client should be closed before exiting.</span>

<span class="sd">    Args:</span>
<span class="sd">        opts: the config settings</span>
<span class="sd">        logger: a logger object</span>

<span class="sd">    Returns:</span>
<span class="sd">        a QdrantClient object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">lmm_education.config.config</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">LocalStorage</span><span class="p">,</span>
        <span class="n">RemoteSource</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">opts</span> <span class="o">=</span> <span class="n">opts</span> <span class="ow">or</span> <span class="n">load_settings</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not initialize client due to invalid settings.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">opts_storage</span><span class="p">:</span> <span class="n">DatabaseSource</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">storage</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">ConfigSettings</span><span class="p">)</span> <span class="k">else</span> <span class="n">opts</span>
        <span class="p">)</span>
        <span class="n">client</span><span class="p">:</span> <span class="n">QdrantClient</span>
        <span class="k">match</span> <span class="n">opts_storage</span><span class="p">:</span>
            <span class="k">case</span> <span class="s1">&#39;:memory:&#39;</span><span class="p">:</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">QdrantClient</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
            <span class="k">case</span> <span class="n">LocalStorage</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">):</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">QdrantClient</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">case</span> <span class="n">RemoteSource</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">):</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">QdrantClient</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid database source&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to the qdrant server, which may be down.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="n">UnexpectedResponse</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not initialize qdrant client: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="n">ApiException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not initialize qdrant client due to API error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># This often caused by accessing qdrant with sync client after</span>
        <span class="c1"># prior acces with async client</span>
        <span class="k">if</span> <span class="s2">&quot;already accessed&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not initialize qdrant client due to &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;previous async initialization?</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not initialize qdrant client due to &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;runtime error:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not initialize qdrant client:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">client</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.encoding_to_qdrantembedding_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">encoding_to_qdrantembedding_model</span><span class="p">(</span><span class="n">em</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Embedding model required for encoding</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">encoding_to_qdrantembedding_model</span><span class="p">(</span>
    <span class="n">em</span><span class="p">:</span> <span class="n">EncodingModel</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QdrantEmbeddingModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Embedding model required for encoding&quot;&quot;&quot;</span>
    <span class="k">match</span> <span class="n">em</span><span class="p">:</span>
        <span class="k">case</span> <span class="n">EncodingModel</span><span class="o">.</span><span class="n">NONE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">UUID</span>
        <span class="k">case</span> <span class="n">EncodingModel</span><span class="o">.</span><span class="n">CONTENT</span> <span class="o">|</span> <span class="n">EncodingModel</span><span class="o">.</span><span class="n">MERGED</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">DENSE</span>
        <span class="k">case</span> <span class="n">EncodingModel</span><span class="o">.</span><span class="n">MULTIVECTOR</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">MULTIVECTOR</span>
        <span class="k">case</span> <span class="n">EncodingModel</span><span class="o">.</span><span class="n">SPARSE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">SPARSE</span>
        <span class="k">case</span> <span class="p">(</span>
            <span class="n">EncodingModel</span><span class="o">.</span><span class="n">SPARSE_CONTENT</span> <span class="o">|</span> <span class="n">EncodingModel</span><span class="o">.</span><span class="n">SPARSE_MERGED</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_DENSE</span>
        <span class="k">case</span> <span class="n">EncodingModel</span><span class="o">.</span><span class="n">SPARSE_MULTIVECTOR</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_MULTIVECTOR</span>
        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Unreachable code reached due to &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;invalid encoding model: &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">em</span><span class="p">)</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.groups_to_points" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">groups_to_points</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>transform a GroupsResult object into a list of ScoredPoint
objects of the group lookup list</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">groups_to_points</span><span class="p">(</span><span class="n">groups</span><span class="p">:</span> <span class="n">GroupsResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoredPoint</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;transform a GroupsResult object into a list of ScoredPoint</span>
<span class="sd">    objects of the group lookup list&quot;&quot;&quot;</span>
    <span class="c1"># assumes groups is structured as it should</span>
    <span class="n">records</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Record</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">g</span><span class="o">.</span><span class="n">lookup</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">groups</span> <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">lookup</span>
    <span class="p">]</span>
    <span class="n">_max</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">list</span><span class="p">[</span><span class="n">ScoredPoint</span><span class="p">]],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">hits</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span>
        <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">score</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hits</span><span class="p">]</span>
    <span class="p">)</span>  <span class="c1"># noqa: E731</span>
    <span class="n">scores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">_max</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">hits</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">groups</span> <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">lookup</span>
    <span class="p">]</span>
    <span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoredPoint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ScoredPoint</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.initialize_collection" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_collection</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">qdrant_model</span><span class="p">,</span> <span class="n">embedding_settings</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check that the collection supports the embedding model, if
already in the database. If not, create a collection supporting
the embedding model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="qdrant_client.QdrantClient">QdrantClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>QdrantClient object encapsulating the conn to the db</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the collection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qdrant_model</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="QdrantEmbeddingModel (lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel)" href="#lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel">QdrantEmbeddingModel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the qdrant embedding model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embedding_settings</code>
            </td>
            <td>
                  <code><span title="lmm.config.config.EmbeddingSettings">EmbeddingSettings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the embedding settings</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a boolean flag indicating that the client may be used with
these parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>the embedding_settings are required to create an embedding to
    obtain the dense embedding vector length, and record in
    the schema their dimension.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initialize_collection</span><span class="p">(</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">QdrantClient</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">qdrant_model</span><span class="p">:</span> <span class="n">QdrantEmbeddingModel</span><span class="p">,</span>
    <span class="n">embedding_settings</span><span class="p">:</span> <span class="n">EmbeddingSettings</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check that the collection supports the embedding model, if</span>
<span class="sd">    already in the database. If not, create a collection supporting</span>
<span class="sd">    the embedding model</span>

<span class="sd">    Args:</span>
<span class="sd">        client: QdrantClient object encapsulating the conn to the db</span>
<span class="sd">        collection_name: the collection.</span>
<span class="sd">        qdrant_model: the qdrant embedding model</span>
<span class="sd">        embedding_settings: the embedding settings</span>

<span class="sd">    Returns:</span>
<span class="sd">        a boolean flag indicating that the client may be used with</span>
<span class="sd">            these parameters.</span>

<span class="sd">    Note:</span>
<span class="sd">        the embedding_settings are required to create an embedding to</span>
<span class="sd">            obtain the dense embedding vector length, and record in</span>
<span class="sd">            the schema their dimension.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">requests.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="ne">ConnectionError</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">lmm.models.langchain.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">create_embeddings</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">encoder</span><span class="p">:</span> <span class="n">Embeddings</span> <span class="o">=</span> <span class="n">create_embeddings</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to the language model.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;Check the internet connection.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not create langchain kernel. Check that langchain &quot;</span>
            <span class="s2">&quot;is installed, and an internet connection is available.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not initialize language model engine:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">client</span><span class="o">.</span><span class="n">collection_exists</span><span class="p">(</span><span class="n">collection_name</span><span class="p">):</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">params</span>  <span class="c1"># noqa  #type: ignore</span>

            <span class="c1"># checks that the opts and the collection</span>
            <span class="c1"># are compatible</span>
            <span class="k">return</span> <span class="n">check_schema</span><span class="p">(</span>
                <span class="n">client</span><span class="p">,</span>
                <span class="n">collection_name</span><span class="p">,</span>
                <span class="n">qdrant_model</span><span class="p">,</span>
                <span class="n">embedding_settings</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># determine embedding size</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="n">qdrant_model</span> <span class="o">==</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">UUID</span>
            <span class="ow">or</span> <span class="n">qdrant_model</span> <span class="o">==</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">SPARSE</span>
        <span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="s2">&quot;Test query&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Could not determine embedding vector size, &quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;cannot embed.</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="n">embedding_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">embedding_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">match</span> <span class="n">qdrant_model</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
                <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">vectors_config</span><span class="o">=</span><span class="p">{}</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">DENSE</span><span class="p">:</span>
                <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">DENSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">VectorParams</span><span class="p">(</span>
                            <span class="n">size</span><span class="o">=</span><span class="n">embedding_size</span><span class="p">,</span>
                            <span class="n">distance</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">COSINE</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">MULTIVECTOR</span><span class="p">:</span>
                <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">DENSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">VectorParams</span><span class="p">(</span>
                            <span class="n">size</span><span class="o">=</span><span class="n">embedding_size</span><span class="p">,</span>
                            <span class="n">distance</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">COSINE</span><span class="p">,</span>
                            <span class="n">multivector_config</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MultiVectorConfig</span><span class="p">(</span>
                                <span class="n">comparator</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MultiVectorComparator</span><span class="o">.</span><span class="n">MAX_SIM</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">SPARSE</span><span class="p">:</span>
                <span class="c1"># TO DO: indices</span>
                <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">vectors_config</span><span class="o">=</span><span class="p">{},</span>
                    <span class="n">sparse_vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">SPARSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVectorParams</span><span class="p">()</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_DENSE</span><span class="p">:</span>
                <span class="c1"># TO DO: indices</span>
                <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">DENSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">VectorParams</span><span class="p">(</span>
                            <span class="n">size</span><span class="o">=</span><span class="n">embedding_size</span><span class="p">,</span>
                            <span class="n">distance</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">COSINE</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">},</span>
                    <span class="n">sparse_vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">SPARSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVectorParams</span><span class="p">()</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_MULTIVECTOR</span><span class="p">:</span>
                <span class="c1"># TO DO: indices</span>
                <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">DENSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">VectorParams</span><span class="p">(</span>
                            <span class="n">size</span><span class="o">=</span><span class="n">embedding_size</span><span class="p">,</span>
                            <span class="n">distance</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Distance</span><span class="o">.</span><span class="n">COSINE</span><span class="p">,</span>
                            <span class="n">multivector_config</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MultiVectorConfig</span><span class="p">(</span>
                                <span class="n">comparator</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">MultiVectorComparator</span><span class="o">.</span><span class="n">MAX_SIM</span>
                            <span class="p">),</span>
                        <span class="p">)</span>
                    <span class="p">},</span>
                    <span class="n">sparse_vectors_config</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">SPARSE_VECTOR_NAME</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVectorParams</span><span class="p">()</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Unreachable code reached due to invalid &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;embedding model: &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qdrant_model</span><span class="p">)</span>
                <span class="p">)</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to the qdrant server, which may be down.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="n">UnexpectedResponse</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not initialize </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="n">ApiException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not initialize </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2"> due to API error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not initialize </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># register the schema</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">check_schema</span><span class="p">(</span>
            <span class="n">client</span><span class="p">,</span>
            <span class="n">collection_name</span><span class="p">,</span>
            <span class="n">qdrant_model</span><span class="p">,</span>
            <span class="n">embedding_settings</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unepected error: </span><span class="si">{</span><span class="n">collection_name</span><span class="si">}</span><span class="s2"> was&quot;</span>
            <span class="s2">&quot;initialized, but the schema could not be&quot;</span>
            <span class="s2">&quot;registered.</span><span class="se">\n</span><span class="s2">Call initialize_collection again to&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;attempt to record schema. Reason for the failure:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># return True nevertheless</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.initialize_collection_from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_collection_from_config</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">collection_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>See initialize_collection. If collection_name is provided, it
will override the collection_name in the config settings object.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initialize_collection_from_config</span><span class="p">(</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">QdrantClient</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">opts</span><span class="p">:</span> <span class="n">ConfigSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See initialize_collection. If collection_name is provided, it</span>
<span class="sd">    will override the collection_name in the config settings object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">opts</span> <span class="o">=</span> <span class="n">opts</span> <span class="ow">or</span> <span class="n">load_settings</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not initialize client due to invalid &quot;</span> <span class="s2">&quot;settings.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">collection_name</span><span class="p">:</span>
        <span class="n">collection_name</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">collection_name</span>

    <span class="k">return</span> <span class="n">initialize_collection</span><span class="p">(</span>
        <span class="n">client</span><span class="p">,</span>
        <span class="n">collection_name</span><span class="p">,</span>
        <span class="n">encoding_to_qdrantembedding_model</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">RAG</span><span class="o">.</span><span class="n">encoding_model</span><span class="p">),</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">embeddings</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.points_to_blocks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">points_to_blocks</span><span class="p">(</span><span class="n">points</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>transform a list of ingestion points into a block list (to
visualize what one ingested)</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">points_to_blocks</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Block</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;transform a list of ingestion points into a block list (to</span>
<span class="sd">    visualize what one ingested)&quot;&quot;&quot;</span>
    <span class="n">blocks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Block</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">MetadataBlock</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">payload</span> <span class="ow">and</span> <span class="s1">&#39;metadata&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">payload</span>
                    <span class="k">else</span> <span class="p">{}</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">TextBlock</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;page_content&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">payload</span> <span class="ow">and</span> <span class="s1">&#39;page_content&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">payload</span>
                    <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">blocks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.points_to_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">points_to_ids</span><span class="p">(</span><span class="n">points</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>transform a list of points into a list of their id's</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">points_to_ids</span><span class="p">(</span>
    <span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoredPoint</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;transform a list of points into a list of their id&#39;s&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.points_to_payload" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">points_to_payload</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">payload_key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>transform a list of points into a list of their payload</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">points_to_payload</span><span class="p">(</span>
    <span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoredPoint</span><span class="p">],</span>
    <span class="n">payload_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;transform a list of points into a list of their payload&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">payload_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">payload</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">payload</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">p</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">payload_key</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">payload</span>
        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.points_to_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">points_to_text</span><span class="p">(</span><span class="n">points</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>transform a list of points into a list of their textual
content</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">points_to_text</span><span class="p">(</span>
    <span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoredPoint</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;transform a list of points into a list of their textual</span>
<span class="sd">    content&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;page_content&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">payload</span> <span class="ow">and</span> <span class="s1">&#39;page_content&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">payload</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.qdrant_client_context" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">qdrant_client_context</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Contructs a client object within a context manager.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="lmm_education.config.config.DatabaseSource">DatabaseSource</span> | <a class="autorefs autorefs-internal" title="ConfigSettings (lmm_education.config.config.ConfigSettings)" href="../Configuration/config/#lmm_education.config.config.ConfigSettings">ConfigSettings</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specification of the database. If none, settings
from config.toml will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="lmm.utils.logging.LoggerBase">LoggerBase</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a logger object.</p>
              </div>
            </td>
            <td>
                  <code><span title="lmm_education.stores.vector_store_qdrant.default_logger">default_logger</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.Generator">Generator</span>[<span title="qdrant_client.QdrantClient">QdrantClient</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a client object context.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="behaviour" open>
  <summary>Behaviour</summary>
  <p>Raises ConnectionError if client initialization fails.
This is standard behavior for context managers.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">qdrant_client_context</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">DatabaseSource</span> <span class="o">|</span> <span class="n">ConfigSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">QdrantClient</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Contructs a client object within a context manager.</span>

<span class="sd">    Args:</span>
<span class="sd">        config: specification of the database. If none, settings</span>
<span class="sd">            from config.toml will be used.</span>
<span class="sd">        logger: a logger object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        a client object context.</span>

<span class="sd">    Behaviour:</span>
<span class="sd">        Raises ConnectionError if client initialization fails.</span>
<span class="sd">        This is standard behavior for context managers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">client_from_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to create Qdrant client&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="s2">&quot;Failed to create Qdrant client&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">client</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing client: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.query" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">query</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">qdrant_model</span><span class="p">,</span> <span class="n">embedding_settings</span><span class="p">,</span> <span class="n">querytext</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;page_content&#39;</span><span class="p">],</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Executes a query on the client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="qdrant_client.QdrantClient">QdrantClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a QdrantClient object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the collection to query</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qdrant_model</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="QdrantEmbeddingModel (lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel)" href="#lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel">QdrantEmbeddingModel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the qdrant embedding model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embedding_settings</code>
            </td>
            <td>
                  <code><span title="lmm.config.config.EmbeddingSettings">EmbeddingSettings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the embedding settings</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>querytext</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the target text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>max number of chunks retrieved</p>
              </div>
            </td>
            <td>
                  <code>12</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>payload</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | <span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>what properties to be retrieved; defaults to the text
retrieved for similarity to the querytext</p>
              </div>
            </td>
            <td>
                  <code>[&#39;page_content&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="lmm.utils.logging.LoggerBase">LoggerBase</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a logger object</p>
              </div>
            </td>
            <td>
                  <code><span title="lmm_education.stores.vector_store_qdrant.default_logger">default_logger</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="qdrant_client.models.ScoredPoint">ScoredPoint</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of ScoredPoint objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">QdrantClient</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">qdrant_model</span><span class="p">:</span> <span class="n">QdrantEmbeddingModel</span><span class="p">,</span>
    <span class="n">embedding_settings</span><span class="p">:</span> <span class="n">EmbeddingSettings</span><span class="p">,</span>
    <span class="n">querytext</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
    <span class="n">payload</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;page_content&#39;</span><span class="p">],</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoredPoint</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a query on the client.</span>

<span class="sd">    Args:</span>
<span class="sd">        client: a QdrantClient object</span>
<span class="sd">        collection_name: the collection to query</span>
<span class="sd">        qdrant_model: the qdrant embedding model</span>
<span class="sd">        embedding_settings: the embedding settings</span>
<span class="sd">        querytext: the target text</span>
<span class="sd">        limit: max number of chunks retrieved</span>
<span class="sd">        payload: what properties to be retrieved; defaults to the text</span>
<span class="sd">            retrieved for similarity to the querytext</span>
<span class="sd">        logger: a logger object</span>

<span class="sd">    Returns:</span>
<span class="sd">        a list of ScoredPoint objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># load language model</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">requests.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="ne">ConnectionError</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">lmm.models.langchain.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">create_embeddings</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">encoder</span><span class="p">:</span> <span class="n">Embeddings</span> <span class="o">=</span> <span class="n">create_embeddings</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to language models.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;Check the internet connection.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not create langchain kernel. Check that langchain &quot;</span>
            <span class="s2">&quot;is installed, and an internet connection is available.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not initialize language model engine:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">response</span><span class="p">:</span> <span class="n">QdrantResponse</span> <span class="o">=</span> <span class="n">QdrantResponse</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">[])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">match</span> <span class="n">qdrant_model</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
                <span class="n">records</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Record</span><span class="p">]</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">querytext</span><span class="p">],</span>
                    <span class="n">with_payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoredPoint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">ScoredPoint</span><span class="p">(</span>
                        <span class="nb">id</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="mi">1</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">records</span>
                <span class="p">]</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">QdrantResponse</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">DENSE</span><span class="p">:</span>
                <span class="n">vect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">vect</span><span class="p">,</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;with_payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">MULTIVECTOR</span><span class="p">:</span>
                <span class="n">vect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">vect</span><span class="p">,</span> <span class="n">vect</span><span class="p">],</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;with_payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">SPARSE</span><span class="p">:</span>
                <span class="n">sparse_model</span> <span class="o">=</span> <span class="n">_get_sparse_model</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
                <span class="n">sparse_embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
                        <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">SPARSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;with_payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_DENSE</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                    <span class="n">sparse_model</span> <span class="o">=</span> <span class="n">_get_sparse_model</span><span class="p">(</span>
                        <span class="n">embedding_settings</span>
                    <span class="p">)</span>
                    <span class="n">sparse_embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not create encoding&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">[]</span>
                <span class="n">dense_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">vect</span><span class="p">,</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">sparse_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
                        <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">SPARSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;prefetch&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">dense_dict</span><span class="p">),</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">sparse_dict</span><span class="p">),</span>
                    <span class="p">],</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">FusionQuery</span><span class="p">(</span>
                        <span class="n">fusion</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Fusion</span><span class="o">.</span><span class="n">RRF</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;with_payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_MULTIVECTOR</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                    <span class="n">sparse_model</span> <span class="o">=</span> <span class="n">_get_sparse_model</span><span class="p">(</span>
                        <span class="n">embedding_settings</span>
                    <span class="p">)</span>
                    <span class="n">sparse_embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not create encoding&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">[]</span>
                <span class="n">dense_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">vect</span><span class="p">,</span> <span class="n">vect</span><span class="p">],</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">sparse_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
                        <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">SPARSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;prefetch&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">dense_dict</span><span class="p">),</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">sparse_dict</span><span class="p">),</span>
                    <span class="p">],</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">FusionQuery</span><span class="p">(</span>
                        <span class="n">fusion</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Fusion</span><span class="o">.</span><span class="n">RRF</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;with_payload&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Unreachable code reached due to invalid &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;embedding model: &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qdrant_model</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to the qdrant server, which may be down.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="n">UnexpectedResponse</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not read from the vector database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="n">ApiException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not read from the database due to API error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not read from the database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.query_grouped" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">query_grouped</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">group_collection</span><span class="p">,</span> <span class="n">qdrant_model</span><span class="p">,</span> <span class="n">embedding_settings</span><span class="p">,</span> <span class="n">querytext</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">group_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">group_field</span><span class="o">=</span><span class="n">GROUP_UUID_KEY</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Executes a grouped query on the client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="qdrant_client.QdrantClient">QdrantClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a QdrantClient object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the collection to query</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>group_collection</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the companion collection that will provide
the output of the query</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qdrant_model</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="QdrantEmbeddingModel (lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel)" href="#lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel">QdrantEmbeddingModel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the qdrant embedding model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embedding_settings</code>
            </td>
            <td>
                  <code><span title="lmm.config.config.EmbeddingSettings">EmbeddingSettings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the embedding settings</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>querytext</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the target text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>max number of chunks retrieved</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>payload</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | <span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>what properties to be retrieved; defaults to all
metadata propoerties. Note that the text is 'page_content',
and this will be included unless payload = False.
If payload = True, all propertes are included.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>group_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>max retrieved output from the group collection</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>group_field</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the filed to group on</p>
              </div>
            </td>
            <td>
                  <code><span title="lmm.scan.scan_keys.GROUP_UUID_KEY">GROUP_UUID_KEY</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="lmm.utils.logging.LoggerBase">LoggerBase</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a logger object</p>
              </div>
            </td>
            <td>
                  <code><span title="lmm_education.stores.vector_store_qdrant.default_logger">default_logger</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="qdrant_client.models.GroupsResult">GroupsResult</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of ScoredPoint objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">query_grouped</span><span class="p">(</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">QdrantClient</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">group_collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">qdrant_model</span><span class="p">:</span> <span class="n">QdrantEmbeddingModel</span><span class="p">,</span>
    <span class="n">embedding_settings</span><span class="p">:</span> <span class="n">EmbeddingSettings</span><span class="p">,</span>
    <span class="n">querytext</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">payload</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">group_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">group_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">GROUP_UUID_KEY</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GroupsResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes a grouped query on the client.</span>

<span class="sd">    Args:</span>
<span class="sd">        client: a QdrantClient object</span>
<span class="sd">        collection_name: the collection to query</span>
<span class="sd">        group_collection: the companion collection that will provide</span>
<span class="sd">            the output of the query</span>
<span class="sd">        qdrant_model: the qdrant embedding model</span>
<span class="sd">        embedding_settings: the embedding settings</span>
<span class="sd">        querytext: the target text</span>
<span class="sd">        limit: max number of chunks retrieved</span>
<span class="sd">        payload: what properties to be retrieved; defaults to all</span>
<span class="sd">            metadata propoerties. Note that the text is &#39;page_content&#39;,</span>
<span class="sd">            and this will be included unless payload = False.</span>
<span class="sd">            If payload = True, all propertes are included.</span>
<span class="sd">        group_size: max retrieved output from the group collection</span>
<span class="sd">        group_field: the filed to group on</span>
<span class="sd">        logger: a logger object</span>

<span class="sd">    Returns:</span>
<span class="sd">        a list of ScoredPoint objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure if payload is given, it contains `page_content`</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;page_content&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
            <span class="n">payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;page_content&#39;</span><span class="p">)</span>

    <span class="c1"># Essentially, the qdrant API declares different</span>
    <span class="c1"># types for any search API.</span>
    <span class="n">NullResult</span><span class="p">:</span> <span class="n">GroupsResult</span> <span class="o">=</span> <span class="n">GroupsResult</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="p">[])</span>
    <span class="c1"># load language model</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">requests.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="ne">ConnectionError</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">lmm.models.langchain.runnables</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
            <span class="n">create_embeddings</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">encoder</span><span class="p">:</span> <span class="n">Embeddings</span> <span class="o">=</span> <span class="n">create_embeddings</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to language models.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;Check the internet connection.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not create langchain kernel. Check that langchain &quot;</span>
            <span class="s2">&quot;is installed, and an internet connection is available.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not initialize language model engine:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>

    <span class="n">response</span><span class="p">:</span> <span class="n">GroupsResult</span> <span class="o">=</span> <span class="n">NullResult</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">match</span> <span class="n">qdrant_model</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span>
                <span class="c1"># ignore grouping</span>
                <span class="n">hits</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ScoredPoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span>
                    <span class="n">client</span><span class="p">,</span>
                    <span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">qdrant_model</span><span class="p">,</span>
                    <span class="n">embedding_settings</span><span class="p">,</span>
                    <span class="n">querytext</span><span class="p">,</span>
                    <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                    <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">GroupsResult</span><span class="p">(</span>
                    <span class="n">groups</span><span class="o">=</span><span class="p">[</span><span class="n">PointGroup</span><span class="p">(</span><span class="n">hits</span><span class="o">=</span><span class="n">hits</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">querytext</span><span class="p">)]</span>
                <span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">DENSE</span><span class="p">:</span>
                <span class="n">vect</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">vect</span><span class="p">,</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;group_by&#39;</span><span class="p">:</span> <span class="n">group_field</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                    <span class="s1">&#39;group_size&#39;</span><span class="p">:</span> <span class="n">group_size</span><span class="p">,</span>
                    <span class="s1">&#39;with_lookup&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">WithLookup</span><span class="p">(</span>
                        <span class="n">collection</span><span class="o">=</span><span class="n">group_collection</span><span class="p">,</span>
                        <span class="n">with_payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                        <span class="n">with_vectors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points_groups</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">MULTIVECTOR</span><span class="p">:</span>
                <span class="n">vect</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">vect</span><span class="p">,</span> <span class="n">vect</span><span class="p">],</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;group_by&#39;</span><span class="p">:</span> <span class="n">group_field</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                    <span class="s1">&#39;group_size&#39;</span><span class="p">:</span> <span class="n">group_size</span><span class="p">,</span>
                    <span class="s1">&#39;with_lookup&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">WithLookup</span><span class="p">(</span>
                        <span class="n">collection</span><span class="o">=</span><span class="n">group_collection</span><span class="p">,</span>
                        <span class="n">with_payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                        <span class="n">with_vectors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points_groups</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">SPARSE</span><span class="p">:</span>
                <span class="n">sparse_model</span><span class="p">:</span> <span class="n">SparseTextEmbedding</span> <span class="o">=</span> <span class="n">_get_sparse_model</span><span class="p">(</span>
                    <span class="n">embedding_settings</span>
                <span class="p">)</span>
                <span class="n">sparse_embeddings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SparseEmbedding</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
                        <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">SPARSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;group_by&#39;</span><span class="p">:</span> <span class="n">group_field</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                    <span class="s1">&#39;group_size&#39;</span><span class="p">:</span> <span class="n">group_size</span><span class="p">,</span>
                    <span class="s1">&#39;with_lookup&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">WithLookup</span><span class="p">(</span>
                        <span class="n">collection</span><span class="o">=</span><span class="n">group_collection</span><span class="p">,</span>
                        <span class="n">with_payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                        <span class="n">with_vectors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points_groups</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_DENSE</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                    <span class="n">sparse_model</span><span class="p">:</span> <span class="n">SparseTextEmbedding</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">_get_sparse_model</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">sparse_embeddings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SparseEmbedding</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not create encoding&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">NullResult</span>
                <span class="n">dense_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">vect</span><span class="p">,</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">sparse_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
                        <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">SPARSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;prefetch&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">dense_dict</span><span class="p">),</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">sparse_dict</span><span class="p">),</span>
                    <span class="p">],</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">FusionQuery</span><span class="p">(</span>
                        <span class="n">fusion</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Fusion</span><span class="o">.</span><span class="n">RRF</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;group_by&#39;</span><span class="p">:</span> <span class="n">group_field</span><span class="p">,</span>
                    <span class="s1">&#39;group_size&#39;</span><span class="p">:</span> <span class="n">group_size</span><span class="p">,</span>
                    <span class="s1">&#39;with_lookup&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">WithLookup</span><span class="p">(</span>
                        <span class="n">collection</span><span class="o">=</span><span class="n">group_collection</span><span class="p">,</span>
                        <span class="n">with_payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                        <span class="n">with_vectors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points_groups</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span> <span class="n">QdrantEmbeddingModel</span><span class="o">.</span><span class="n">HYBRID_MULTIVECTOR</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                    <span class="n">sparse_model</span><span class="p">:</span> <span class="n">SparseTextEmbedding</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">_get_sparse_model</span><span class="p">(</span><span class="n">embedding_settings</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">sparse_embeddings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SparseEmbedding</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">sparse_model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">querytext</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not create encoding&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">NullResult</span>
                <span class="n">dense_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">vect</span><span class="p">,</span> <span class="n">vect</span><span class="p">],</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">DENSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">sparse_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">SparseVector</span><span class="p">(</span>
                        <span class="n">indices</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
                        <span class="n">values</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">sparse_embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;using&#39;</span><span class="p">:</span> <span class="n">SPARSE_VECTOR_NAME</span><span class="p">,</span>
                    <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">query_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;collection_name&#39;</span><span class="p">:</span> <span class="n">collection_name</span><span class="p">,</span>
                    <span class="s1">&#39;prefetch&#39;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">dense_dict</span><span class="p">),</span>
                        <span class="n">models</span><span class="o">.</span><span class="n">Prefetch</span><span class="p">(</span><span class="o">**</span><span class="n">sparse_dict</span><span class="p">),</span>
                    <span class="p">],</span>
                    <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">FusionQuery</span><span class="p">(</span>
                        <span class="n">fusion</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Fusion</span><span class="o">.</span><span class="n">RRF</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;group_by&#39;</span><span class="p">:</span> <span class="n">group_field</span><span class="p">,</span>
                    <span class="s1">&#39;group_size&#39;</span><span class="p">:</span> <span class="n">group_size</span><span class="p">,</span>
                    <span class="s1">&#39;with_lookup&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">WithLookup</span><span class="p">(</span>
                        <span class="n">collection</span><span class="o">=</span><span class="n">group_collection</span><span class="p">,</span>
                        <span class="n">with_payload</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                        <span class="n">with_vectors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">query_points_groups</span><span class="p">(</span><span class="o">**</span><span class="n">query_dict</span><span class="p">)</span>

            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Unreachable code reached due to invalid &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;embedding model: &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">qdrant_model</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to the qdrant server, which may be down.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>
    <span class="k">except</span> <span class="n">UnexpectedResponse</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not read from the vector database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>
    <span class="k">except</span> <span class="n">ApiException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not read from the database due to API error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not read from the database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">NullResult</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="lmm_education.stores.vector_store_qdrant.upload" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upload</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">qdrant_model</span><span class="p">,</span> <span class="n">embedding_settings</span><span class="p">,</span> <span class="n">chunks</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">default_logger</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Upload a list of chunks into the Qdrant database</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="qdrant_client.QdrantClient">QdrantClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the connection to the database</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the collection</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qdrant_model</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="QdrantEmbeddingModel (lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel)" href="#lmm_education.stores.vector_store_qdrant.QdrantEmbeddingModel">QdrantEmbeddingModel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the qdrant embedding model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>embedding_settings</code>
            </td>
            <td>
                  <code><span title="lmm.config.config.EmbeddingSettings">EmbeddingSettings</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the embedding settings</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunks</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="lmm.scan.chunks.Chunk">Chunk</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the chunk list</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="qdrant_client.models.PointStruct">PointStruct</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of Point objects</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>lmm_education/stores/vector_store_qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">upload</span><span class="p">(</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">QdrantClient</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">qdrant_model</span><span class="p">:</span> <span class="n">QdrantEmbeddingModel</span><span class="p">,</span>
    <span class="n">embedding_settings</span><span class="p">:</span> <span class="n">EmbeddingSettings</span><span class="p">,</span>
    <span class="n">chunks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Chunk</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LoggerBase</span> <span class="o">=</span> <span class="n">default_logger</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Upload a list of chunks into the Qdrant database</span>

<span class="sd">    Args:</span>
<span class="sd">        client: the connection to the database</span>
<span class="sd">        collection_name: the collection</span>
<span class="sd">        qdrant_model: the qdrant embedding model</span>
<span class="sd">        embedding_settings: the embedding settings</span>
<span class="sd">        chunks: the chunk list</span>

<span class="sd">    Returns:</span>
<span class="sd">        a list of Point objects</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">initialize_collection</span><span class="p">(</span>
        <span class="n">client</span><span class="p">,</span>
        <span class="n">collection_name</span><span class="p">,</span>
        <span class="n">qdrant_model</span><span class="p">,</span>
        <span class="n">embedding_settings</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not initialize collection.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunks_to_points</span><span class="p">(</span>
        <span class="n">chunks</span><span class="p">,</span> <span class="n">qdrant_model</span><span class="p">,</span> <span class="n">embedding_settings</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">points</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">client</span><span class="o">.</span><span class="n">upsert</span><span class="p">(</span><span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Could not connect to the qdrant server, which may be down.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="n">UnexpectedResponse</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not write to vector database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="n">ApiException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not write to database due to API error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not upload chunks to database:</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">return</span> <span class="n">points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
    show_root_heading: false</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>